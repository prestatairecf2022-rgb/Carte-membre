<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vérification Carte Membre</title>
<style>
  body { font-family: Arial; text-align: center; margin-top: 50px; }
  .valide { color: green; font-size: 24px; }
  .suspendue { color: orange; font-size: 24px; }
  .nonvalide { color: red; font-size: 24px; }
</style>
</head>
<body>

<h1>Vérification de Carte</h1>
<p id="message">Chargement...</p>

<script>
// Lien CSV de ton Google Sheet publié
const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2b_-zD5_FRVndUKewJzSAfR41uA71TRKUm__OPRXUwdmwe7YiSRIp0tP7VWqW2jy0Furvn7FGiBQi/pub?output=csv";

// Récupérer l'ID du QR code depuis l'URL
const params = new URLSearchParams(window.location.search);
const code = params.get('id');

const message = document.getElementById("message");

// Lire le CSV du Google Sheet
fetch(sheetCSV)
  .then(response => response.text())
  .then(csvText => {
    const lines = csvText.split('\n');
    let found = false;

    for(let i=1; i<lines.length; i++){ // Commence à 1 pour sauter l'en-tête
      const row = lines[i].split(',');
      const codeUnique = row[6]?.trim(); // Colonne G = Code unique
      const statut = row[9]?.trim();     // Colonne J = Statut

      if(code && code.toUpperCase() === codeUnique){
        found = true;
        if(statut === "Valide") message.className = "valide";
        else if(statut === "Suspendue") message.className = "suspendue";
        else message.className = "nonvalide";

        message.textContent = "Statut de la carte : " + statut;
        break;
      }
    }

    if(!found){
      message.className = "nonvalide";
      message.textContent = "Code non reconnu / Non valide";
    }
  })
  .catch(err => {
    message.className = "nonvalide";
    message.textContent = "Erreur lors de la vérification.";
    console.error(err);
  });
</script>

</body>
</html>
